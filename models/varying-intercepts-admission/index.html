<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel="shortcut icon" type="image/png" href="/TuringModels.jl/assets/favicon.png"/> <link rel=stylesheet  href="/TuringModels.jl/libs/highlight/github.min.css"> <link rel=stylesheet  href="/TuringModels.jl/css/franklin.css"> <title>Varying intercepts admission decisions</title> <div class=franklin-content > <div class=top-bar > <a href="/TuringModels.jl/">TuringModels</a> </div> <h1>Varying intercepts admission decisions</h1> </div> <div class=franklin-content > <div class=franklin-toc ><ol><li><a href="#data">Data</a><li><a href="#model">Model</a><li><a href="#output">Output</a><li><a href="#original_output">Original output</a></ol></div> <h2 id=data ><a href="#data">Data</a></h2> <pre><code class="julia hljs"><span class=hljs-keyword >import</span> CSV
<span class=hljs-keyword >import</span> TuringModels

<span class=hljs-keyword >using</span> DataFrames

data_path = joinpath(TuringModels.project_root, <span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-string >&quot;UCBadmit.csv&quot;</span>)
df = CSV.read(data_path, DataFrame; delim=<span class=hljs-string >&#x27;;&#x27;</span>)

dept_map = <span class=hljs-built_in >Dict</span>(key =&gt; idx <span class=hljs-keyword >for</span> (idx, key) <span class=hljs-keyword >in</span> enumerate(unique(df.dept)))
df.male = [g == <span class=hljs-string >&quot;male&quot;</span> ? <span class=hljs-number >1</span> : <span class=hljs-number >0</span> <span class=hljs-keyword >for</span> g <span class=hljs-keyword >in</span> df.gender]
df.dept_id = [dept_map[de] <span class=hljs-keyword >for</span> de <span class=hljs-keyword >in</span> df.dept]</code></pre><pre><code class="plaintext hljs">12-element Array{Int64,1}:
 1
 1
 2
 2
 3
 3
 4
 4
 5
 5
 6
 6</code></pre> <h2 id=model ><a href="#model">Model</a></h2> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> Turing

<span class=hljs-meta >@model</span> <span class=hljs-keyword >function</span> m13_3(applications, dept_id, male, admit)
    Rho ~ LKJ(<span class=hljs-number >2</span>, <span class=hljs-number >2.</span>)
    sigma_dept ~ filldist(truncated(Cauchy(<span class=hljs-number >0</span>, <span class=hljs-number >2</span>), <span class=hljs-number >0</span>, <span class=hljs-literal >Inf</span>), <span class=hljs-number >2</span>)
    bm ~ Normal(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>)
    a ~ Normal(<span class=hljs-number >0</span>, <span class=hljs-number >1</span>)

    dist_mu = [a, bm]
    dist_Sigma = sigma_dept .* Rho .* sigma_dept&#x27;
    dist_Sigma = (dist_Sigma&#x27; + dist_Sigma) / <span class=hljs-number >2</span>

    a_bm_dept ~ filldist(MvNormal(dist_mu, dist_Sigma), <span class=hljs-number >6</span>)

    a_dept, bm_dept = a_bm_dept[<span class=hljs-number >1</span>, :], a_bm_dept[<span class=hljs-number >2</span>, :]
    logit_p = a_dept[dept_id] + bm_dept[dept_id] .* male

    admit .~ BinomialLogit.(applications, logit_p)
<span class=hljs-keyword >end</span>;</code></pre> <h2 id=output ><a href="#output">Output</a></h2> <pre><code class="julia hljs">chains = sample(
    m13_3(df.applications, df.dept_id, df.male, df.admit),
    NUTS(<span class=hljs-number >0.95</span>),
    <span class=hljs-number >1000</span>
)</code></pre><pre><code class="plaintext hljs">Chains MCMC chain (1000×32×1 Array{Float64,3}):

Iterations        = 1:1000
Thinning interval = 1
Chains            = 1
Samples per chain = 1000
parameters        = Rho[1,1], Rho[1,2], Rho[2,1], Rho[2,2], a, a_bm_dept[1,1], a_bm_dept[1,2], a_bm_dept[1,3], a_bm_dept[1,4], a_bm_dept[1,5], a_bm_dept[1,6], a_bm_dept[2,1], a_bm_dept[2,2], a_bm_dept[2,3], a_bm_dept[2,4], a_bm_dept[2,5], a_bm_dept[2,6], bm, sigma_dept[1], sigma_dept[2]
internals         = acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, is_accept, log_density, lp, max_hamiltonian_energy_error, n_steps, nom_step_size, numerical_error, step_size, tree_depth

Summary Statistics
      parameters      mean       std   naive_se      mcse         ess      rhat
          Symbol   Float64   Float64    Float64   Float64     Float64   Float64

        Rho[1,1]    1.0000    0.0000     0.0000    0.0000         NaN       NaN
        Rho[1,2]   -0.3363    0.3420     0.0108    0.0142    810.3126    1.0034
        Rho[2,1]   -0.3363    0.3420     0.0108    0.0142    810.3126    1.0034
        Rho[2,2]    1.0000    0.0000     0.0000    0.0000    949.0249    0.9990
               a   -0.3269    0.5709     0.0181    0.0167    934.0719    1.0006
  a_bm_dept[1,1]    1.3054    0.2531     0.0080    0.0060    854.7716    0.9991
  a_bm_dept[1,2]    0.7602    0.3253     0.0103    0.0074    922.7136    0.9992
  a_bm_dept[1,3]   -0.6475    0.0870     0.0028    0.0018   1247.3989    0.9990
  a_bm_dept[1,4]   -0.6180    0.1048     0.0033    0.0028   1147.2039    0.9990
  a_bm_dept[1,5]   -1.1276    0.1094     0.0035    0.0032   1207.1096    0.9990
  a_bm_dept[1,6]   -2.6046    0.2030     0.0064    0.0052   1097.6554    1.0006
  a_bm_dept[2,1]   -0.7868    0.2654     0.0084    0.0061    830.0813    0.9991
  a_bm_dept[2,2]   -0.2350    0.3246     0.0103    0.0079    887.3583    0.9994
  a_bm_dept[2,3]    0.0763    0.1352     0.0043    0.0031   1050.0968    0.9993
  a_bm_dept[2,4]   -0.0874    0.1419     0.0045    0.0025   1190.5207    0.9996
  a_bm_dept[2,5]    0.1263    0.1830     0.0058    0.0075   1094.8179    1.0005
  a_bm_dept[2,6]   -0.1138    0.2661     0.0084    0.0079   1023.7148    0.9998
              bm   -0.1721    0.2351     0.0074    0.0076   1030.8719    0.9991
   sigma_dept[1]    1.6326    0.5763     0.0182    0.0161   1016.0338    1.0008
   sigma_dept[2]    0.4953    0.2706     0.0086    0.0077    670.4255    0.9993

Quantiles
      parameters      2.5%     25.0%     50.0%     75.0%     97.5%
          Symbol   Float64   Float64   Float64   Float64   Float64

        Rho[1,1]    1.0000    1.0000    1.0000    1.0000    1.0000
        Rho[1,2]   -0.8652   -0.6071   -0.3756   -0.1148    0.4383
        Rho[2,1]   -0.8652   -0.6071   -0.3756   -0.1148    0.4383
        Rho[2,2]    1.0000    1.0000    1.0000    1.0000    1.0000
               a   -1.4317   -0.6901   -0.3585    0.0058    0.9293
  a_bm_dept[1,1]    0.8115    1.1355    1.3032    1.4779    1.7885
  a_bm_dept[1,2]    0.1200    0.5583    0.7437    0.9670    1.4056
  a_bm_dept[1,3]   -0.8179   -0.7052   -0.6467   -0.5875   -0.4809
  a_bm_dept[1,4]   -0.8257   -0.6836   -0.6178   -0.5532   -0.4209
  a_bm_dept[1,5]   -1.3431   -1.2023   -1.1305   -1.0529   -0.9130
  a_bm_dept[1,6]   -3.0345   -2.7401   -2.6049   -2.4651   -2.2323
  a_bm_dept[2,1]   -1.3082   -0.9709   -0.7957   -0.6140   -0.2512
  a_bm_dept[2,2]   -0.8562   -0.4416   -0.2328   -0.0198    0.3772
  a_bm_dept[2,3]   -0.1763   -0.0189    0.0751    0.1674    0.3423
  a_bm_dept[2,4]   -0.3682   -0.1777   -0.0848   -0.0021    0.1928
  a_bm_dept[2,5]   -0.2418    0.0098    0.1260    0.2395    0.5063
  a_bm_dept[2,6]   -0.6579   -0.2799   -0.1013    0.0588    0.3783
              bm   -0.6258   -0.3109   -0.1642   -0.0329    0.2827
   sigma_dept[1]    0.8633    1.2443    1.5239    1.8780    3.0170
   sigma_dept[2]    0.1519    0.3168    0.4378    0.6000    1.1725
</code></pre> </p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> StatsPlots

StatsPlots.plot(chains)</code></pre> <p> <img src="/TuringModels.jl/assets/models/varying-intercepts-admission/code/output/chains.svg" alt=""> <h2 id=original_output ><a href="#original_output">Original output</a></h2> <pre><code class="julia hljs">m_13_3_rethinking = <span class=hljs-string >&quot;&quot;&quot;
Inference for Stan model: f0d86ec689cbf7921aab4fc0f55616d2.
    4 chains, each with iter=5000; warmup=1000; thin=1;
    post-warmup draws per chain=4000, total post-warmup draws=16000.

                      mean se_mean   sd     2.5%      25%      50%      75%
    bm_dept[1]       -0.79    0.00 0.27    -1.32    -0.97    -0.79    -0.61
    bm_dept[2]       -0.21    0.00 0.33    -0.87    -0.42    -0.20     0.00
    bm_dept[3]        0.08    0.00 0.14    -0.18    -0.01     0.08     0.18
    bm_dept[4]       -0.09    0.00 0.14    -0.37    -0.19    -0.09     0.00
    bm_dept[5]        0.12    0.00 0.19    -0.24    -0.01     0.12     0.25
    bm_dept[6]       -0.12    0.00 0.27    -0.67    -0.29    -0.12     0.05
    a_dept[1]         1.30    0.00 0.25     0.82     1.13     1.30     1.47
    a_dept[2]         0.74    0.00 0.33     0.08     0.52     0.73     0.95
    a_dept[3]        -0.65    0.00 0.09    -0.82    -0.71    -0.65    -0.59
    a_dept[4]        -0.62    0.00 0.10    -0.83    -0.69    -0.62    -0.55
    a_dept[5]        -1.13    0.00 0.11    -1.36    -1.21    -1.13    -1.05
    a_dept[6]        -2.60    0.00 0.20    -3.01    -2.73    -2.60    -2.46
    a                -0.49    0.01 0.73    -1.96    -0.91    -0.49    -0.07
    bm               -0.16    0.00 0.24    -0.65    -0.29    -0.16    -0.02
    sigma_dept[1]     1.67    0.01 0.63     0.88     1.25     1.53     1.94
    sigma_dept[2]     0.50    0.00 0.26     0.16     0.33     0.45     0.61
    Rho[1,1]          1.00     NaN 0.00     1.00     1.00     1.00     1.00
    Rho[1,2]         -0.31    0.00 0.35    -0.87    -0.59    -0.35    -0.08
    Rho[2,1]         -0.31    0.00 0.35    -0.87    -0.59    -0.35    -0.08
    Rho[2,2]          1.00    0.00 0.00     1.00     1.00     1.00     1.00
    lp__          -2593.92    0.04 3.17 -2601.03 -2595.85 -2593.57 -2591.65
                     97.5% n_eff Rhat
    bm_dept[1]       -0.27  6918    1
    bm_dept[2]        0.46  9133    1
    bm_dept[3]        0.36 13016    1
    bm_dept[4]        0.19 12258    1
    bm_dept[5]        0.49 12953    1
    bm_dept[6]        0.40 12011    1
    a_dept[1]         1.81  6993    1
    a_dept[2]         1.39  9335    1
    a_dept[3]        -0.48 13489    1
    a_dept[4]        -0.42 12595    1
    a_dept[5]        -0.91 14659    1
    a_dept[6]        -2.23 13168    1
    a                 0.96  9541    1
    bm                0.31  8946    1
    sigma_dept[1]     3.27  9058    1
    sigma_dept[2]     1.15  6626    1
    Rho[1,1]          1.00   NaN  NaN
    Rho[1,2]          0.44 11358    1
    Rho[2,1]          0.44 11358    1
    Rho[2,2]          1.00 16069    1
    lp__          -2588.70  5310    1
&quot;&quot;&quot;</span>;</code></pre> <div class=page-foot > <div class=copyright > <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> Rob Goedman, Richard Torkar, Rik Huijzer, Martin Trapp and contributors. Last modified: January 27, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>