<!doctype html> <html lang=en > <meta charset=UTF-8 > <meta name=viewport  content="width=device-width, initial-scale=1"> <link rel="shortcut icon" type="image/png" href="/TuringModels.jl/assets/favicon.png"/> <link rel=stylesheet  href="/TuringModels.jl/libs/highlight/github.min.css"> <link rel=stylesheet  href="/TuringModels.jl/css/franklin.css"> <title>Ignoring gender for admittance</title> <div class=franklin-content > <div class=top-bar > <a href="/TuringModels.jl/">TuringModels</a> </div> <h1>Ignoring gender for admittance</h1> </div> <div class=franklin-content > <p>This is model 13.4 from Statistical Rethinking Edition 1.</p> <div class=franklin-toc ><ol><li><a href="#data">Data</a><li><a href="#model">Model</a><li><a href="#output">Output</a><li><a href="#original_output">Original output</a></ol></div> <h2 id=data ><a href="#data">Data</a></h2> <pre><code class="julia hljs"><span class=hljs-keyword >import</span> CSV

<span class=hljs-keyword >using</span> DataFrames
<span class=hljs-keyword >using</span> Turing
<span class=hljs-keyword >using</span> TuringModels

data_path = joinpath(TuringModels.project_root, <span class=hljs-string >&quot;data&quot;</span>, <span class=hljs-string >&quot;UCBadmit.csv&quot;</span>)
df = CSV.read(data_path, DataFrame; delim=<span class=hljs-string >&#x27;;&#x27;</span>)

dept_map = <span class=hljs-built_in >Dict</span>(key =&gt; idx <span class=hljs-keyword >for</span> (idx, key) <span class=hljs-keyword >in</span> enumerate(unique(df.dept)))
df.male = [g == <span class=hljs-string >&quot;male&quot;</span> ? <span class=hljs-number >1</span> : <span class=hljs-number >0</span> <span class=hljs-keyword >for</span> g <span class=hljs-keyword >in</span> df.gender]
df.dept_id = [dept_map[de] <span class=hljs-keyword >for</span> de <span class=hljs-keyword >in</span> df.dept]
df</code></pre><pre><code class="plaintext hljs">12×7 DataFrame
 Row │ dept    gender  admit  reject  applications  male   dept_id
     │ String  String  Int64  Int64   Int64         Int64  Int64
─────┼─────────────────────────────────────────────────────────────
   1 │ A       male      512     313           825      1        1
   2 │ A       female     89      19           108      0        1
   3 │ B       male      353     207           560      1        2
   4 │ B       female     17       8            25      0        2
   5 │ C       male      120     205           325      1        3
   6 │ C       female    202     391           593      0        3
   7 │ D       male      138     279           417      1        4
   8 │ D       female    131     244           375      0        4
   9 │ E       male       53     138           191      1        5
  10 │ E       female     94     299           393      0        5
  11 │ F       male       22     351           373      1        6
  12 │ F       female     24     317           341      0        6</code></pre> <h2 id=model ><a href="#model">Model</a></h2> <pre><code class="julia hljs"><span class=hljs-meta >@model</span> <span class=hljs-keyword >function</span> m13_4(applications, dept_id, male, admit)
    sigma_dept ~ truncated(Cauchy(<span class=hljs-number >0</span>, <span class=hljs-number >2</span>), <span class=hljs-number >0</span>, <span class=hljs-literal >Inf</span>)
    a ~ Normal(<span class=hljs-number >0</span>, <span class=hljs-number >10</span>)
    a_dept ~ filldist(Normal(a, sigma_dept), <span class=hljs-number >6</span>)

    logit_p = a_dept[dept_id]

    admit .~ BinomialLogit.(applications, logit_p)
<span class=hljs-keyword >end</span>;</code></pre> <h2 id=output ><a href="#output">Output</a></h2> <pre><code class="julia hljs">chains = sample(
    m13_4(df.applications, df.dept_id, df.male, df.admit),
    Turing.NUTS(<span class=hljs-number >0.65</span>),
    <span class=hljs-number >5000</span>
)</code></pre><pre><code class="plaintext hljs">Chains MCMC chain (5000×20×1 Array{Float64,3}):

Iterations        = 1:5000
Thinning interval = 1
Chains            = 1
Samples per chain = 5000
parameters        = a, a_dept[1], a_dept[2], a_dept[3], a_dept[4], a_dept[5], a_dept[6], sigma_dept
internals         = acceptance_rate, hamiltonian_energy, hamiltonian_energy_error, is_accept, log_density, lp, max_hamiltonian_energy_error, n_steps, nom_step_size, numerical_error, step_size, tree_depth

Summary Statistics
  parameters      mean       std   naive_se      mcse         ess      rhat
      Symbol   Float64   Float64    Float64   Float64     Float64   Float64

           a   -0.6677    0.6531     0.0092    0.0114   2895.1202    0.9999
   a_dept[1]    0.5900    0.0690     0.0010    0.0008   7013.6813    0.9998
   a_dept[2]    0.5383    0.0842     0.0012    0.0008   6967.6459    0.9999
   a_dept[3]   -0.6161    0.0699     0.0010    0.0009   6656.0733    0.9998
   a_dept[4]   -0.6654    0.0732     0.0010    0.0008   6794.9576    0.9999
   a_dept[5]   -1.0893    0.0944     0.0013    0.0015   6391.6063    1.0004
   a_dept[6]   -2.6526    0.1526     0.0022    0.0018   6445.7544    0.9998
  sigma_dept    1.4623    0.5936     0.0084    0.0098   3003.7414    0.9999

Quantiles
  parameters      2.5%     25.0%     50.0%     75.0%     97.5%
      Symbol   Float64   Float64   Float64   Float64   Float64

           a   -1.9610   -1.0320   -0.6634   -0.2949    0.6050
   a_dept[1]    0.4551    0.5431    0.5877    0.6369    0.7247
   a_dept[2]    0.3740    0.4805    0.5369    0.5951    0.7031
   a_dept[3]   -0.7569   -0.6617   -0.6157   -0.5703   -0.4810
   a_dept[4]   -0.8096   -0.7146   -0.6648   -0.6162   -0.5230
   a_dept[5]   -1.2783   -1.1524   -1.0881   -1.0254   -0.9034
   a_dept[6]   -2.9571   -2.7535   -2.6525   -2.5468   -2.3563
  sigma_dept    0.7661    1.0761    1.3258    1.6737    2.9442
</code></pre> </p> <pre><code class="julia hljs"><span class=hljs-keyword >using</span> StatsPlots

StatsPlots.plot(chains)</code></pre> <p> <img src="/TuringModels.jl/assets/models/ignoring-gender-admit/code/output/chains.svg" alt=""> <h2 id=original_output ><a href="#original_output">Original output</a></h2> <pre><code class="julia hljs">m_13_4_rethinking = <span class=hljs-string >&quot;&quot;&quot;
Inference for Stan model: 0c5c36512c20c41995d1bd25be525138.
    3 chains, each with iter=4500; warmup=500; thin=1;
    post-warmup draws per chain=4000, total post-warmup draws=12000.

                   mean se_mean   sd     2.5%      25%      50%      75%    97.5%
    a_dept[1]      0.59    0.00 0.07     0.46     0.54     0.59     0.64     0.73
    a_dept[2]      0.54    0.00 0.09     0.37     0.48     0.54     0.60     0.71
    a_dept[3]     -0.62    0.00 0.07    -0.75    -0.66    -0.62    -0.57    -0.49
    a_dept[4]     -0.67    0.00 0.08    -0.81    -0.72    -0.67    -0.62    -0.52
    a_dept[5]     -1.09    0.00 0.10    -1.28    -1.15    -1.09    -1.03    -0.90
    a_dept[6]     -2.65    0.00 0.15    -2.96    -2.75    -2.65    -2.55    -2.37
    a             -0.63    0.01 0.63    -1.89    -1.01    -0.64    -0.26     0.66
    sigma_dept     1.45    0.01 0.57     0.77     1.08     1.33     1.68     2.90
    lp__       -2602.37    0.03 2.08 -2607.45 -2603.49 -2602.01 -2600.86 -2599.35
               n_eff Rhat
    a_dept[1]  11285    1
    a_dept[2]  11943    1
    a_dept[3]  12707    1
    a_dept[4]  11592    1
    a_dept[5]  14598    1
    a_dept[6]  13363    1
    a           6965    1
    sigma_dept  5643    1
    lp__        5322    1
&quot;&quot;&quot;</span>;</code></pre> <div class=page-foot > <div class=copyright > &copy; Rob Goedman, Richard Torkar, Rik Huijzer, Martin Trapp and contributors. Last modified: January 16, 2021. Website built with <a href="https://github.com/tlienart/Franklin.jl">Franklin.jl</a> and the <a href="https://julialang.org">Julia programming language</a>. </div> </div> </div>